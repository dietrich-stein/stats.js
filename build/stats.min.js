function t(t,i){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);i&&(s=s.filter((function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable}))),e.push.apply(e,s)}return e}function i(i){for(var e=1;e<arguments.length;e++){var h=null!=arguments[e]?arguments[e]:{};e%2?t(Object(h),!0).forEach((function(t){s(i,t,h[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(h)):t(Object(h)).forEach((function(t){Object.defineProperty(i,t,Object.getOwnPropertyDescriptor(h,t))}))}return i}function e(t,i){for(var e=0;e<i.length;e++){var s=i[e];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,h(s.key),s)}}function s(t,i,e){return(i=h(i))in t?Object.defineProperty(t,i,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[i]=e,t}function h(t){var i=function(t,i){if("object"!=typeof t||null===t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var s=e.call(t,i||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===i?String:Number)(t)}(t,"string");return"symbol"==typeof i?i:String(i)}var o=function(){function t(e){!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,t);this.config=i(i({},{maxFps:60,maxMb:100,drawInterval:1e3,containerStyle:"position:fixed;top:0;left:0;opacity:0.9;z-index:10000",canvasStyle:"width:160px;height:96px",showFps:!0,showMs:!0,showMb:!0,frameColor:"#000022",graphColor:"#112244",fpsColor:"#ffffff",fpsTextColor:"#ffffff",msColor:"#00ffff",msTextColor:"#00ffff",mbColor:"#ff00ff",mbTextColor:"#ff00ff"}),e),this.MAX_MS=1e3/this.config.maxFps,this.PR=2*Math.round(window.devicePixelRatio||1),this.WIDTH=80*this.PR,this.HEIGHT=48*this.PR,this.TEXT_X=3*this.PR,this.TEXT_Y=2*this.PR,this.GRAPH_X=3*this.PR,this.GRAPH_Y=25*this.PR,this.GRAPH_WIDTH=74*this.PR,this.GRAPH_HEIGHT=20*this.PR,this.TEXT_Y_2=this.GRAPH_Y/2,this.lastFps=0,this.lastMs=0,this.lastMsY=this.GRAPH_HEIGHT,this.lastMb=0,this.lastMbY=this.GRAPH_HEIGHT,this.isReadMemTest=!1,this.isReadMemTestMem=0,this.isReadMemTestTime=(performance||Date).now()+5e3,this.canReadMem=!1,self.performance&&self.performance.memory&&self.performance.memory.usedJSHeapSize&&(this.isReadMemTest=!0,this.isReadMemTestMem=self.performance.memory.usedJSHeapSize),this.dom=document.createElement("div"),this.dom.style.cssText=e.containerStyle,this.canvas=document.createElement("canvas"),this.canvas.width=this.WIDTH,this.canvas.height=this.HEIGHT,this.canvas.style.cssText=this.config.canvasStyle,this.dom.appendChild(this.canvas),this.context=this.canvas.getContext("2d"),this.context.font="bold "+9*this.PR+"px Helvetica,Arial,sans-serif",this.context.textBaseline="top",this.context.fillStyle=this.config.frameColor,this.context.fillRect(0,0,this.WIDTH,this.HEIGHT),this.context.fillStyle=this.config.graphColor,this.context.fillRect(this.GRAPH_X,this.GRAPH_Y,this.GRAPH_WIDTH,this.GRAPH_HEIGHT),this.beginTime=(performance||Date).now(),this.prevTime=this.beginTime,this.frames=0,this.maxTime=0}var s,h,o;return s=t,(h=[{key:"getFps",value:function(){return this.lastFps}},{key:"getMs",value:function(){return this.lastMs}},{key:"getMb",value:function(){return this.lastMb}},{key:"begin",value:function(){this.beginTime=(performance||Date).now()}},{key:"end",value:function(){this.frames++;var t=(performance||Date).now(),i=t-this.beginTime;if(this.maxTime<i&&(this.maxTime=i),t>=this.prevTime+this.config.drawInterval){var e=0;this.config.showMb&&(this.isReadMemTest&&(this.isReadMemTestMem!==performance.memory.usedJSHeapSize?(this.isReadMemTest=!1,this.canReadMem=!0):this.isReadMemTestTime<t&&(this.isReadMemTest=!1)),this.canReadMem&&(e=window.performance.memory.usedJSHeapSize/1048576)),this.context.fillStyle=this.config.frameColor,this.context.fillRect(0,0,this.WIDTH,this.GRAPH_Y);var s="";if(this.config.showFps&&(this.lastFps=1e3*this.frames/(t-this.prevTime),s=Math.round(this.lastFps)+" FPS",this.context.fillStyle=this.config.fpsTextColor,this.context.fillText(s,this.TEXT_X,this.TEXT_Y)),this.config.showMs&&(this.lastMs=this.maxTime,s=Math.round(this.lastMs)+" MS",this.context.fillStyle=this.config.msTextColor,this.context.fillText(s,this.GRAPH_WIDTH/2+3*this.PR,this.TEXT_Y)),this.config.showMb&&(this.lastMb=e,s=Math.round(this.lastMb)+" MB",this.context.fillStyle=this.config.mbTextColor,this.context.fillText(s,this.TEXT_X,this.TEXT_Y_2)),this.context.drawImage(this.canvas,this.GRAPH_X+this.PR,this.GRAPH_Y,this.GRAPH_WIDTH-this.PR,this.GRAPH_HEIGHT,this.GRAPH_X,this.GRAPH_Y,this.GRAPH_WIDTH-this.PR,this.GRAPH_HEIGHT),this.context.fillStyle=this.config.graphColor,this.context.fillRect(this.GRAPH_X+this.GRAPH_WIDTH-this.PR,this.GRAPH_Y,this.PR,this.GRAPH_HEIGHT),this.config.showFps){this.context.fillStyle=this.config.fpsColor;var h=Math.round((1-this.lastFps/this.config.maxFps)*this.GRAPH_HEIGHT);h<0&&(h=0),this.context.fillRect(this.GRAPH_X+this.GRAPH_WIDTH-this.PR,this.GRAPH_Y+h,this.PR,this.PR)}this.config.showMs&&(this.lastMsY=this.drawLineGraph(this.config.msColor,this.MAX_MS,this.lastMs,this.lastMsY)),this.config.showMb&&(this.lastMbY=this.drawLineGraph(this.config.mbColor,this.config.maxMb,this.lastMb,this.lastMbY)),this.prevTime=t,this.frames=0,this.maxTime=0}return t}},{key:"update",value:function(){this.beginTime=this.end()}},{key:"drawLineGraph",value:function(t,i,e,s){this.context.fillStyle=t;var h=Math.round((1-e/i)*this.GRAPH_HEIGHT);this.GRAPH_HEIGHT-this.PR<h?h=this.GRAPH_HEIGHT-this.PR:h<0&&(h=0);var o=Math.min(h,s),n=Math.max(h,s)-o;return n<this.PR&&(n=this.PR),this.context.fillRect(this.GRAPH_X+this.GRAPH_WIDTH-this.PR,this.GRAPH_Y+o,this.PR,n),h}}])&&e(s.prototype,h),o&&e(s,o),Object.defineProperty(s,"prototype",{writable:!1}),t}();export{o as default};
